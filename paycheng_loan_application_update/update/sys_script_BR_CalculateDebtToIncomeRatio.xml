<?xml version="1.0" encoding="UTF-8"?>
<sys_script action="INSERT_OR_UPDATE" active="true" name="Calculate Debt-to-Income Ratio" order="300" sys_class_name="sys_script" sys_id="br_calculate_dti" sys_package="x_1603889_paycheng" sys_scope="x_1603889_paycheng" sys_update_name="sys_script_BR_CalculateDebtToIncomeRatio" when="before">
    <abort_action>false</abort_action>
    <action>insert,update</action>
    <api_name>Calculate Debt-to-Income Ratio</api_name>
    <caller_access/>
    <client_callable>false</client_callable>
    <collection>x_1603889_paycheng_loan_application</collection>
    <condition>u_monthly_income != '' AND u_monthly_expenses != ''</condition>
    <description>Calculate debt-to-income ratio automatically</description>
    <execute_function/>
    <filter_condition/>
    <is_rest>false</is_rest>
    <ns><![CDATA[global]]></ns>
    <result><![CDATA[(function executeRule(current, previous /*null when async*/) {
    var monthlyIncome = parseFloat(current.u_monthly_income);
    var monthlyExpenses = parseFloat(current.u_monthly_expenses);
    var existingLoans = parseFloat(current.u_existing_loans) || 0;
    
    if (monthlyIncome > 0) {
        var totalDebt = monthlyExpenses + existingLoans;
        current.u_debt_to_income_ratio = (totalDebt / monthlyIncome) * 100;
    }
})(current, previous);]]></result>
    <script><![CDATA[(function executeRule(current, previous /*null when async*/) {
    var monthlyIncome = parseFloat(current.u_monthly_income);
    var monthlyExpenses = parseFloat(current.u_monthly_expenses);
    var existingLoans = parseFloat(current.u_existing_loans) || 0;
    
    if (monthlyIncome > 0) {
        var totalDebt = monthlyExpenses + existingLoans;
        current.u_debt_to_income_ratio = (totalDebt / monthlyIncome) * 100;
    }
})(current, previous);]]></script>
    <sys_class_name>sys_script</sys_class_name>
    <sys_created_by>admin</sys_created_by>
    <sys_created_on>2025-11-16 15:00:00</sys_created_on>
    <sys_id>br_calculate_dti</sys_id>
    <sys_mod_count>0</sys_mod_count>
    <sys_name>Calculate Debt-to-Income Ratio</sys_name>
    <sys_package display_value="Paycheng" source="x_1603889_paycheng">x_1603889_paycheng</sys_package>
    <sys_policy/>
    <sys_scope display_value="Paycheng" source="x_1603889_paycheng">x_1603889_paycheng</sys_scope>
    <sys_update_name>sys_script_BR_CalculateDebtToIncomeRatio</sys_update_name>
    <sys_updated_by>admin</sys_updated_by>
    <sys_updated_on>2025-11-16 15:00:00</sys_updated_on>
    <template/>
    <when>before</when>
</sys_script>

